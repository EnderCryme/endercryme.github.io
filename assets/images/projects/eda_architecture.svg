<svg width="1200" height="950" viewBox="0 0 1200 950" xmlns="http://www.w3.org/2000/svg">
    <defs>
        <!-- FlÃ¨ches -->
        <marker id="arrow" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
            <polygon points="0 0, 10 3.5, 0 7" fill="#555"/>
        </marker>
        <marker id="arrowOrange" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
            <polygon points="0 0, 10 3.5, 0 7" fill="#f97316"/>
        </marker>
        
        <!-- Filtre ombre -->
        <filter id="shadow" x="-20%" y="-20%" width="140%" height="140%">
            <feDropShadow dx="2" dy="2" stdDeviation="3" flood-color="#000000" flood-opacity="0.12"/>
        </filter>
    </defs>

    <!-- Fond -->
    <rect width="1200" height="950" fill="#fafafa"/>

    <!-- ============================================================ -->
    <!-- TITRE PRINCIPAL -->
    <!-- ============================================================ -->
    <text x="600" y="35" font-family="Arial, sans-serif" font-size="22" font-weight="bold" fill="#333" text-anchor="middle">Architecture RL - Optimisation Standard Cells</text>

    <!-- ============================================================ -->
    <!-- ZONE GAUCHE : INTERFACE UTILISATEUR -->
    <!-- ============================================================ -->
    <rect x="20" y="60" width="280" height="340" rx="15" fill="#f0fdf4" stroke="#86efac" stroke-width="2"/>
    <text x="160" y="90" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#166534" text-anchor="middle">Interface Utilisateur</text>

    <!-- Utilisateur -->
    <ellipse cx="160" cy="140" rx="60" ry="28" fill="#fecaca" stroke="#f87171" stroke-width="2"/>
    <text x="160" y="146" font-family="Arial, sans-serif" font-size="14" fill="#991b1b" text-anchor="middle">Utilisateur</text>

    <!-- GUI -->
    <rect x="70" y="195" width="180" height="65" rx="12" fill="#86efac" stroke="#22c55e" stroke-width="2" filter="url(#shadow)"/>
    <text x="160" y="222" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#166534" text-anchor="middle">Interface</text>
    <text x="160" y="242" font-family="Arial, sans-serif" font-size="12" fill="#166534" text-anchor="middle">PyQt6 (GUI)</text>

    <!-- Workers -->
    <rect x="70" y="290" width="180" height="55" rx="10" fill="#bfdbfe" stroke="#3b82f6" stroke-width="2" filter="url(#shadow)"/>
    <text x="160" y="315" font-family="Arial, sans-serif" font-size="13" font-weight="bold" fill="#1e40af" text-anchor="middle">Workers</text>
    <text x="160" y="333" font-family="Arial, sans-serif" font-size="11" fill="#1e40af" text-anchor="middle">(QThread)</text>

    <!-- FlÃ¨ches interface -->
    <path d="M 160 168 L 160 192" stroke="#555" stroke-width="2" marker-end="url(#arrow)"/>
    <path d="M 160 260 L 160 287" stroke="#555" stroke-width="2" marker-end="url(#arrow)"/>

    <!-- ============================================================ -->
    <!-- ZONE CENTRALE : BOUCLE RL -->
    <!-- ============================================================ -->
    <rect x="320" y="60" width="500" height="420" rx="15" fill="#fffbeb" stroke="#fcd34d" stroke-width="2"/>
    <text x="570" y="90" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#b45309" text-anchor="middle">Boucle Reinforcement Learning</text>

    <!-- Agent PPO -->
    <rect x="350" y="250" width="180" height="80" rx="15" fill="#fdba74" stroke="#f97316" stroke-width="3" filter="url(#shadow)"/>
    <text x="440" y="295" font-family="Arial, sans-serif" font-size="15" font-weight="bold" fill="#c2410c" text-anchor="middle">Agent PPO (RL)</text>

    <!-- Env Gym -->
    <rect x="610" y="250" width="180" height="80" rx="15" fill="#fde047" stroke="#eab308" stroke-width="2" filter="url(#shadow)"/>
    <text x="700" y="282" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#a16207" text-anchor="middle">Env Gym</text>
    <text x="700" y="305" font-family="Arial, sans-serif" font-size="11" fill="#a16207" text-anchor="middle">(StandardCellEnv)</text>

    <!-- FlÃ¨ches Agent <-> Env -->
    <path d="M 530 270 L 605 270" stroke="#f97316" stroke-width="2.5" marker-end="url(#arrowOrange)"/>
    <path d="M 605 310 L 530 310" stroke="#f97316" stroke-width="2.5" marker-end="url(#arrowOrange)"/>

    <!-- Labels Action / Obs+Reward -->
    <rect x="540" y="235" width="55" height="22" rx="4" fill="#fff7ed" stroke="#fdba74" stroke-width="1"/>
    <text x="567" y="250" font-family="Arial, sans-serif" font-size="10" font-weight="bold" fill="#c2410c" text-anchor="middle">Action</text>

    <rect x="530" y="318" width="85" height="22" rx="4" fill="#fff7ed" stroke="#fdba74" stroke-width="1"/>
    <text x="572" y="333" font-family="Arial, sans-serif" font-size="10" font-weight="bold" fill="#c2410c" text-anchor="middle">Obs / Reward</text>

    <!-- BoÃ®te Action dÃ©taillÃ©e -->
    <rect x="360" y="115" width="170" height="110" rx="8" fill="#ffffff" stroke="#f97316" stroke-width="1.5"/>
    <text x="445" y="138" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#c2410c" text-anchor="middle">Action (Î”W)</text>
    <line x1="370" y1="148" x2="520" y2="148" stroke="#fdba74" stroke-width="1"/>
    <text x="380" y="168" font-family="Courier, monospace" font-size="10" fill="#555">âˆ†W âˆˆ [-0.2, +0.2]</text>
    <text x="380" y="188" font-family="Courier, monospace" font-size="10" fill="#555">W_new = WÃ—(1+âˆ†W)</text>
    <text x="380" y="208" font-family="Courier, monospace" font-size="10" fill="#555">W âˆˆ [420nm, 5Âµm]</text>

    <!-- FlÃ¨che Action box -> Agent -->
    <path d="M 445 225 L 445 247" stroke="#f97316" stroke-width="1.5" stroke-dasharray="4,2" marker-end="url(#arrowOrange)"/>

    <!-- BoÃ®te Observation dÃ©taillÃ©e -->
    <rect x="610" y="115" width="180" height="110" rx="8" fill="#ffffff" stroke="#eab308" stroke-width="1.5"/>
    <text x="700" y="138" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#a16207" text-anchor="middle">Observation</text>
    <line x1="620" y1="148" x2="780" y2="148" stroke="#fcd34d" stroke-width="1"/>
    <text x="630" y="168" font-family="Courier, monospace" font-size="10" fill="#555">obs = [</text>
    <text x="640" y="185" font-family="Courier, monospace" font-size="9" fill="#555">W_norm[n_trans],</text>
    <text x="640" y="200" font-family="Courier, monospace" font-size="9" fill="#555">metrics_norm[8],</text>
    <text x="640" y="215" font-family="Courier, monospace" font-size="9" fill="#555">targets_norm[8]</text>

    <!-- FlÃ¨che Obs box -> Env -->
    <path d="M 700 225 L 700 247" stroke="#eab308" stroke-width="1.5" stroke-dasharray="4,2"/>

    <!-- FlÃ¨che Workers -> Agent -->
    <path d="M 250 317 L 295 317 L 295 290 L 347 290" stroke="#555" stroke-width="2" marker-end="url(#arrow)"/>

    <!-- ============================================================ -->
    <!-- ZONE DROITE : CALCUL REWARD -->
    <!-- ============================================================ -->
    <rect x="840" y="60" width="340" height="340" rx="15" fill="#fdf2f8" stroke="#f9a8d4" stroke-width="2"/>
    <text x="1010" y="90" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#be185d" text-anchor="middle">Calcul Reward (V1.2)</text>

    <!-- Contenu Reward -->
    <text x="860" y="120" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#555">1. Erreurs relatives :</text>
    <text x="875" y="140" font-family="Courier, monospace" font-size="10" fill="#666">err = |val - target| / target</text>

    <text x="860" y="168" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#555">2. PÃ©nalitÃ© quadratique :</text>
    <text x="875" y="188" font-family="Courier, monospace" font-size="10" fill="#666">R -= weight Ã— errÂ²</text>

    <text x="860" y="216" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#555">3. PondÃ©rations strictes :</text>
    <text x="875" y="236" font-family="Courier, monospace" font-size="10" fill="#666">delay &lt; 50ps â†’ w = 5</text>
    <text x="875" y="253" font-family="Courier, monospace" font-size="10" fill="#666">power &lt; 1pW â†’ w = 5</text>

    <text x="860" y="281" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#555">4. PÃ©nalitÃ© physique (ratio P/N) :</text>
    <text x="875" y="301" font-family="Courier, monospace" font-size="10" fill="#666">if W_PMOS &lt; W_NMOS:</text>
    <text x="885" y="318" font-family="Courier, monospace" font-size="10" fill="#666">R -= 5 Ã— (Wn - Wp) / Wn</text>

    <text x="860" y="346" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#555">5. Bonus succÃ¨s :</text>
    <text x="875" y="366" font-family="Courier, monospace" font-size="10" fill="#666">if all(err â‰¤ 10%): R += 20</text>

    <!-- FlÃ¨che Env -> Reward -->
    <path d="M 790 290 L 837 290" stroke="#ec4899" stroke-width="2" marker-end="url(#arrow)"/>

    <!-- ============================================================ -->
    <!-- ZONE BAS : SIMULATION -->
    <!-- ============================================================ -->
    <rect x="320" y="500" width="500" height="300" rx="15" fill="#fdf4ff" stroke="#e879f9" stroke-width="2"/>
    <text x="570" y="530" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#a21caf" text-anchor="middle">Coeur de Simulation</text>

    <!-- Objective Function -->
    <rect x="460" y="560" width="180" height="65" rx="12" fill="#f9a8d4" stroke="#ec4899" stroke-width="2" filter="url(#shadow)"/>
    <text x="550" y="590" font-family="Arial, sans-serif" font-size="13" font-weight="bold" fill="#be185d" text-anchor="middle">Objective Function</text>
    <text x="550" y="610" font-family="Arial, sans-serif" font-size="10" fill="#be185d" text-anchor="middle">GÃ©nÃ¨re Netlist + Calcule CoÃ»t</text>

    <!-- NGSpice -->
    <rect x="460" y="680" width="180" height="65" rx="12" fill="#e9d5ff" stroke="#a855f7" stroke-width="2" filter="url(#shadow)"/>
    <text x="550" y="710" font-family="Arial, sans-serif" font-size="13" font-weight="bold" fill="#7e22ce" text-anchor="middle">NGSpice</text>
    <text x="550" y="730" font-family="Arial, sans-serif" font-size="10" fill="#7e22ce" text-anchor="middle">(Simulateur SPICE)</text>

    <!-- FlÃ¨ches Simulation -->
    <path d="M 700 330 L 700 380 L 550 380 L 550 557" stroke="#555" stroke-width="2" marker-end="url(#arrow)"/>
    <text x="715" y="365" font-family="Arial, sans-serif" font-size="10" fill="#666">Widths</text>

    <path d="M 510 625 L 510 677" stroke="#555" stroke-width="2" marker-end="url(#arrow)"/>
    <text x="480" y="658" font-family="Arial, sans-serif" font-size="10" fill="#666">Netlist</text>

    <path d="M 590 677 L 590 625" stroke="#555" stroke-width="2" marker-end="url(#arrow)"/>
    <text x="620" y="658" font-family="Arial, sans-serif" font-size="10" fill="#666">MÃ©triques</text>

    <!-- Retour MÃ©triques -> Env -->
    <path d="M 640 592 L 750 592 L 750 420 L 700 420 L 700 333" stroke="#a855f7" stroke-width="2" marker-end="url(#arrow)"/>
    <text x="765" y="500" font-family="Arial, sans-serif" font-size="10" fill="#7e22ce">RÃ©sultats</text>

    <!-- ============================================================ -->
    <!-- ZONE BAS GAUCHE : MÃ‰TRIQUES -->
    <!-- ============================================================ -->
    <rect x="20" y="500" width="280" height="200" rx="15" fill="#ecfdf5" stroke="#6ee7b7" stroke-width="2"/>
    <text x="160" y="530" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#047857" text-anchor="middle">MÃ©triques Cibles</text>

    <text x="40" y="560" font-family="Courier, monospace" font-size="11" fill="#555">â€¢ delay_rise / delay_fall</text>
    <text x="40" y="582" font-family="Courier, monospace" font-size="11" fill="#555">â€¢ slew_in / slew_out</text>
    <text x="40" y="604" font-family="Courier, monospace" font-size="11" fill="#555">â€¢ power_dyn / power_leak</text>
    <text x="40" y="626" font-family="Courier, monospace" font-size="11" fill="#555">â€¢ area_um2</text>

    <line x1="35" y1="645" x2="285" y2="645" stroke="#6ee7b7" stroke-width="1"/>
    <text x="40" y="668" font-family="Arial, sans-serif" font-size="10" fill="#666">ðŸŽ² Training : random targets</text>
    <text x="40" y="688" font-family="Arial, sans-serif" font-size="10" fill="#666">ðŸŽ¯ Inference : user targets</text>

    <!-- FlÃ¨che MÃ©triques -> Simulation -->
    <path d="M 300 600 L 457 592" stroke="#6ee7b7" stroke-width="2" marker-end="url(#arrow)"/>

    <!-- ============================================================ -->
    <!-- ZONE BAS DROITE : PERSISTANCE -->
    <!-- ============================================================ -->
    <rect x="840" y="500" width="340" height="200" rx="15" fill="#f5f5f5" stroke="#d4d4d4" stroke-width="2"/>
    <text x="1010" y="530" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#525252" text-anchor="middle">Persistance ModÃ¨le</text>

    <!-- Weight Manager -->
    <rect x="880" y="560" width="160" height="50" rx="8" fill="#e5e5e5" stroke="#a3a3a3" stroke-width="2" filter="url(#shadow)"/>
    <text x="960" y="592" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#525252" text-anchor="middle">Weight Manager</text>

    <!-- JSON Cylindre -->
    <g transform="translate(880, 640)">
        <ellipse cx="80" cy="10" rx="70" ry="12" fill="#d4d4d4" stroke="#a3a3a3" stroke-width="1"/>
        <rect x="10" y="10" width="140" height="40" fill="#e5e5e5"/>
        <ellipse cx="80" cy="50" rx="70" ry="12" fill="#d4d4d4" stroke="#a3a3a3" stroke-width="1"/>
        <line x1="10" y1="10" x2="10" y2="50" stroke="#a3a3a3" stroke-width="1"/>
        <line x1="150" y1="10" x2="150" y2="50" stroke="#a3a3a3" stroke-width="1"/>
        <text x="80" y="38" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#525252" text-anchor="middle">JSON / ModÃ¨les</text>
    </g>

    <!-- FlÃ¨ches Persistance -->
    <path d="M 960 610 L 960 637" stroke="#555" stroke-width="2" marker-end="url(#arrow)"/>

    <!-- FlÃ¨che Agent -> Weight Manager -->
    <path d="M 440 330 L 440 420 L 820 420 L 820 585 L 877 585" stroke="#555" stroke-width="2" marker-end="url(#arrow)"/>
    <text x="630" y="410" font-family="Arial, sans-serif" font-size="10" fill="#666">Save/Load weights</text>

    <!-- ============================================================ -->
    <!-- LÃ‰GENDE -->
    <!-- ============================================================ -->
    <rect x="20" y="720" width="280" height="180" rx="10" fill="#ffffff" stroke="#e5e5e5" stroke-width="1"/>
    <text x="160" y="745" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#333" text-anchor="middle">LÃ©gende</text>
    
    <rect x="40" y="760" width="20" height="15" rx="3" fill="#86efac" stroke="#22c55e" stroke-width="1"/>
    <text x="70" y="772" font-family="Arial, sans-serif" font-size="10" fill="#555">Interface utilisateur</text>
    
    <rect x="40" y="785" width="20" height="15" rx="3" fill="#fdba74" stroke="#f97316" stroke-width="1"/>
    <text x="70" y="797" font-family="Arial, sans-serif" font-size="10" fill="#555">Agent RL (PPO)</text>
    
    <rect x="40" y="810" width="20" height="15" rx="3" fill="#fde047" stroke="#eab308" stroke-width="1"/>
    <text x="70" y="822" font-family="Arial, sans-serif" font-size="10" fill="#555">Environnement Gym</text>
    
    <rect x="40" y="835" width="20" height="15" rx="3" fill="#f9a8d4" stroke="#ec4899" stroke-width="1"/>
    <text x="70" y="847" font-family="Arial, sans-serif" font-size="10" fill="#555">Simulation / Objectif</text>
    
    <rect x="40" y="860" width="20" height="15" rx="3" fill="#e5e5e5" stroke="#a3a3a3" stroke-width="1"/>
    <text x="70" y="872" font-family="Arial, sans-serif" font-size="10" fill="#555">Persistance donnÃ©es</text>

</svg>
